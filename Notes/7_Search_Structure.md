# 第7章 搜索结构

## 7.1 静态搜索结构

- 顺序搜索
- 基于有序顺序表的顺序搜索和折半搜索
- 斐波那契搜索

## 7.2 二叉搜索树

**二叉搜索树** (binary search tree) 或者是一棵空树，或者是具有下列性质的二叉树。
(1) 每个结点都有一个作为搜索依据的关键码 (key），所有结点的关键码互不相同。
(2) 左子树（如果存在）上所有结点的关键码都小于根结点的关键码。
(3) 右子树（如果存在）上所有结点的关键码都大于根结点的关键码。
( 4) 左子树和右子树也是二叉搜索树。

如果对一棵二叉搜索树进行中序遍历．可以按从小到大的顺序｀ 将各结点关键码排列起来。

在二叉搜索树上进行**搜索**， 是一个从根结点开始，沿某一个分支逐层向下进行比较判等的过程。

为了向二叉搜索树中**插入**一个新元素，必须先检查这个元素是否在树中已经存在。所以在插入之前，先使用搜索符法在树中检查要插入的元素是否存在。如果搜索成功，说明树中已经有这个元素． 则不再插入；如果搜索不成功， 说明树中原来没有关键码等于给定值的结点，则把新元素加到搜索操作停止的地方。

对于有 $n$ 个关键码的集合，其关键码有 $n!$ 种不同的排列，可构成的不同二叉搜索树有 $\frac{1}{n+1} \binom{2n}{n}$ 棵。


## 7.3 AVL 树

### 7.3.1 AVL 树的概念

一棵 AVL 树或者是空树，或者是具有下列性质的二叉搜索树：它的左子树和右子树都是 AVL 树，且左子树和右子树的高度之差的绝对值不超过1 。

结点的**平衡因子** (balance factor, bf)：结点右子树的高度减去左子树的高度所得的高度差。根据 AVL 树的定义，任一结点的平衡因子只能取-1, 0 和1。

如果一棵 AVL 树有 $n$ 个结点，其高度可保持在 $O(\log_2n)$，平均搜索长度也可保持在 $O(\log_2n)$。

### 7.3.2 平衡化旋转

平衡化旋转有两类：单旋转和双旋转。单旋转可按其方向分为左单旋转和右单旋转，而双旋转分为先左后右和先右后左两类。

在插入一个新结点后，需要从插入位置沿通向根的路径回溯，检查各结点左、右子树的高度差。如果在某一结点发现高度不平衡，则停止回溯。从发生不平衡的结点起，沿刚才回溯的路径取直接下两层的结点。如果这 3 个结点处于一条直线上，则采用单旋转进行平衡化；如果这 3 个结点处于一条折线上，则采用双旋转进行平衡化。

#### 1. 左单旋转

![[Pasted image 20251216191604.png]]

#### 2. 右单旋转

![[Pasted image 20251216191621.png]]

#### 3. 先左后右双旋转

![[Pasted image 20251216191640.png]]

#### 4. 先右后左双旋转

![[Pasted image 20251216191657.png]]

A ***violation*** might occur in four case when we insert new node to the AVL tree.
- **Case 1**: an insertion into the left subtree of the left child of R.
- **Case 2**: an insertion into the right subtree of the left child of R.
- **Case 3**: an insertion into the left subtree of the right child of R.
- **Case 4**: an insertion into the right subtree of the right child of R.

| Four types       | Rotation                  |
|------------------|---------------------------|
| Case 1: Left-left | Right rotation            |
| Case 4: Right-right | Left rotation          |
| Case 2: Left-right | Left-right double rotation |
| Case 3: Right-left | Right-left double rotation |

### 7.3.3 AVL 树的插入

设新插入的结点为 $p$，从结点 $p$ 到根结点的路径上，每个结点为根的子树的高度都可能增加1。因此在每执行一次二叉搜索树的插入运算后，都需从新插入的结点 $p$ 开始，沿该结点的插入路径向根结点方向回溯，修改各结点的平衡因子，调整子树的高度，恢复被破坏的平衡性质。

新结点 $p$ 的平衡因子为0。现在来考查**它的父结点 $p_r$**，若 $p$ 是 $p_r$ 的右子女，则 $p_r$ 的平衡因子加1，否则 $p_r$ 的平衡因子少1。按照修改后 $p_r$ 的平衡因子值有3种情况。

**（1）结点 $p_r$ 的平衡因子为0**。说明刚才是在 $p_r$ 的较矮的子树上插入了新结点，结点 $p_r$ 处平衡，且其高度没有增减。此时从 $p_r$ 到根的路径上各结点为根的子树高度不变，从而各结点的平衡因子不变，可以结束重新平衡化的处理，返回主程序。
![[Pasted image 20251216193126.png]]

**（2）结点 $p_r$ 的平衡因子的绝对值 $|\text{bf}| = 1$**。说明插入前 $p_r$ 的平衡因子是0，插入新结点后，以 $p_r$ 为根的子树没有失去平衡，不需平衡化旋转。但该子树的高度增加，还需从结点 $p_r$ 向根的方向回溯，继续考查结点 $p_r$ 的父结点的平衡状态。
![[Pasted image 20251216193140.png]]

**（3）结点 $p_r$ 的平衡因子的绝对值 $|\text{bf}| = 2$**。说明新结点在较高的子树上插入，造成了不平衡，需要做平衡化旋转。此时可进一步分两种情况讨论：
① 若结点 $p_r$ 的 $\text{bf} = 2$，说明右子树高，结合其右子女 $q$ 的 $\text{bf}$ 分别处理：
- 若 $q$ 的 $\text{bf}$ 为1，执行左单旋转；
- 若 $q$ 的 $\text{bf}$ 为-1，执行先右后左双旋转。
![[Pasted image 20251216193158.png]]
② 若结点 $p_r$ 的 $\text{bf} = -2$，说明左子树高，结合其左子女 $q$ 的 $\text{bf}$ 分别处理：
- 若 $q$ 的 $\text{bf}$ 为-1，执行右单旋转；
- 若 $q$ 的 $\text{bf}$ 为1，执行先左后右双旋转。

**旋转后以 $p_r$ 为根的子树高度降低，因此无须继续向上层回溯**。

### 7.3.4 AVL  树的删除

#### 1. 如果被删结点 $p$ 有两个子女

首先搜索 $p$ 在中序次序下的直接前驱 $q$（同样可以找直接后继）。再把结点 $q$ 的内容传送给结点 $p$，现在问题转移到删除结点 $q$。把结点 $q$ 当作被删结点 $p$，它是只有一个子女的结点。

#### 2. 如果被删结点 $p$ 最多只有一个子女 $q$

可以简单地把 $p$ 的父结点 $p_r$ 中原来指向 $p$ 的指针改指到 $q$；如果结点 $p$ 没有子女，$p$ 的父结点 $p_r$ 的相应指针置为 NULL。然后将原来以结点 $p_r$ 为根的子树的高度减 1，并沿 $p_r$ 通向根的路径反向追踪高度的这一变化对路径上各个结点的影响。

考查结点 $q$ 的父结点 $p_r$。若 $q$ 是 $p_r$ 的左子女，则 $p_r$ 的平衡因子应当增加 1，否则减少 1。根据修改后的 $p_r$ 的平衡因子值，按 3 种情况分别进行处理。

（1）$p_r$ 的平衡因子原来为 0，在它的左子树或右子树被缩短后，则它的平衡因子改为 1 或 −1。由于以 $p_r$ 为根的子树高度没有改变，从 $p_r$ 到根结点的路径上所有结点都不需要调整。此时可结束本次删除的重新平衡过程，如图 7.18 所示。

![[Pasted image 20251216194522.png]]

（2）结点 $p_r$ 的平衡因子原不为 0，且较高的子树被缩短，则 $p$ 的平衡因子改为 0。此时以 $p_r$ 为根的子树平衡，但其高度减 1。为此需要继续考查结点 $p_r$ 的父结点的平衡状态，如图 7.19 所示。

![[Pasted image 20251216194541.png]]

（3）结点 $p_r$ 的平衡因子原不为 0，且较矮的子树又被缩短，则在结点 $p_r$ 发生不平衡。为此需进行平衡化旋转来恢复平衡。令 $p_r$ 的较高的子树的根为 $q$（该子树未被缩短），根据 $q$ 的平衡因子，有如下 3 种平衡化操作。

① 如果 $q$ 的平衡因子为 0，执行一个单旋转来恢复结点 $p_r$ 的平衡，如图 7.20 所示。图中是左单旋转的例子，右单旋转的情形可以对称地处理。由于平衡旋转后以 $q$ 为根的子树的高度没有发生改变，从 $q$ 到根的路径上所有结点的平衡因子不变。此时可以结束重新平衡的过程。

![[Pasted image 20251216194559.png]]

② 如果 $q$ 的平衡因子与 $p_r$ 的平衡因子（正负）号相同，则执行一个单旋转来恢复平衡，结点 $p_r$ 和 $q$ 的平衡因子均改为 0，如图 7.21 所示。图中是左单旋转的例子，右单旋转的情形可以对称地处理。由于经过平衡旋转后结点 $q$ 的子树高度降低 1，故需要继续沿插入路径向上考查结点 $q$ 的父结点的平衡状态，即将当前考查结点向根结点方向上移。

![[Pasted image 20251216194609.png]]

③ 如果 $p_r$ 与 $q$ 的平衡因子（正负）号相反，则执行一个双旋转来恢复平衡，先围绕 $q$ 转，再围绕 $p_r$ 转。新的根结点的平衡因子置为 0，其他结点的平衡因子相应处理，同时由于经过平衡化处理后子树的高度降低 1，还需要考查它的父结点，继续向上层进行平衡化工作，如图 7.22 所示。

![[Pasted image 20251216194623.png]]


### 7.3.5 AVL 树的性能分析


## 7.4 伸展树


## 7.5 红黑树